<div class="exam-results-page">
  @if (examResult()) {
    <div class="results-container">
      <!-- Results Header -->
      <div class="results-header text-center">
        <div class="status-icon-large mb-3" [class.success]="isPassed" [class.danger]="!isPassed">
          <i [class]="'bi ' + statusIcon"></i>
        </div>
        
        <h1 class="results-title mb-2" [class.text-success]="isPassed" [class.text-danger]="!isPassed">
          {{ statusMessage }}
        </h1>
        
        <p class="text-muted">Here are your exam results</p>
      </div>

      <!-- Score Card -->
      <div class="score-card mb-4">
        <div class="score-display">
          <div class="score-circle" [class.passed]="isPassed" [class.failed]="!isPassed">
            <svg viewBox="0 0 200 200">
              <circle
                class="score-bg"
                cx="100"
                cy="100"
                r="90"
                fill="none"
                stroke-width="12"
              ></circle>
              <circle
                class="score-progress"
                cx="100"
                cy="100"
                r="90"
                fill="none"
                stroke-width="12"
                [attr.stroke-dasharray]="2 * 3.14159 * 90"
                [attr.stroke-dashoffset]="2 * 3.14159 * 90 * (1 - scorePercentage / 100)"
                transform="rotate(-90 100 100)"
              ></circle>
            </svg>
            <div class="score-text">
              <div class="score-value">{{ scorePercentage }}%</div>
              <div class="score-label">Your Score</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="row g-3 mb-4">
        <div class="col-md-3 col-6">
          <div class="stat-card">
            <div class="stat-icon primary">
              <i class="bi bi-list-check"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ examResult()!.totalQuestions }}</div>
              <div class="stat-label">Total Questions</div>
            </div>
          </div>
        </div>

        <div class="col-md-3 col-6">
          <div class="stat-card">
            <div class="stat-icon success">
              <i class="bi bi-check-circle"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ examResult()!.correctAnswers }}</div>
              <div class="stat-label">Correct Answers</div>
            </div>
          </div>
        </div>

        <div class="col-md-3 col-6">
          <div class="stat-card">
            <div class="stat-icon danger">
              <i class="bi bi-x-circle"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ examResult()!.totalQuestions - examResult()!.correctAnswers }}</div>
              <div class="stat-label">Incorrect Answers</div>
            </div>
          </div>
        </div>

        <div class="col-md-3 col-6">
          <div class="stat-card">
            <div class="stat-icon indigo">
              <i class="bi bi-clock-history"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ examResult()!.timeTaken }}</div>
              <div class="stat-label">Time Taken</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pass/Fail Status Banner -->
      <div class="alert" [class.alert-success]="isPassed" [class.alert-danger]="!isPassed" role="alert">
        <div class="d-flex align-items-center">
          <i [class]="'bi ' + statusIcon + ' me-3 fs-3'"></i>
          <div class="flex-grow-1">
            @if (isPassed) {
              <h5 class="alert-heading mb-1">Exam Passed! ðŸŽ‰</h5>
              <p class="mb-0">
                You scored {{ scorePercentage }}% which is above the passing threshold of 80%.
                The HR team will review your application and contact you for the next steps.
              </p>
            } @else {
              <h5 class="alert-heading mb-1">Exam Not Passed</h5>
              <p class="mb-0">
                You scored {{ scorePercentage }}% which is below the passing threshold of 80%.
                Don't be discouraged! Keep improving your skills and apply for other opportunities.
              </p>
            }
          </div>
        </div>
      </div>

      <!-- Answer Review Section -->
      <div class="answer-review-section mt-4">
        <div class="section-header" (click)="toggleAnswerReview()">
          <h4 class="mb-0">
            <i class="bi bi-eye me-2"></i>
            Review Your Answers
          </h4>
          <button class="btn btn-sm btn-outline-primary">
            <i class="bi" [class.bi-chevron-down]="!showAnswerReview()" [class.bi-chevron-up]="showAnswerReview()"></i>
          </button>
        </div>

        @if (showAnswerReview()) {
          <div class="review-content mt-3">
            @for (question of examResult()!.questions; track question.id) {
              <div class="question-review-card mb-3">
                <div class="question-review-header">
                  <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                      <span class="question-number">Question {{ question.questionNumber }}</span>
                      @if (isCorrectAnswer(question)) {
                        <span class="badge bg-success ms-2">
                          <i class="bi bi-check-circle me-1"></i>Correct
                        </span>
                      } @else {
                        <span class="badge bg-danger ms-2">
                          <i class="bi bi-x-circle me-1"></i>Incorrect
                        </span>
                      }
                    </div>
                  </div>
                  <p class="question-review-text mt-2 mb-0">{{ question.questionText }}</p>
                </div>

                <div class="question-review-body">
                  @for (choice of question.answerChoices; track $index) {
                    <div 
                      class="answer-review-option"
                      [class.correct]="$index === question.correctAnswerIndex"
                      [class.incorrect]="$index === getUserAnswerForQuestion(question)?.selectedAnswerIndex && $index !== question.correctAnswerIndex"
                      [class.user-selected]="$index === getUserAnswerForQuestion(question)?.selectedAnswerIndex">
                      <div class="answer-review-label">
                        {{ getAnswerLabel($index) }}.
                      </div>
                      <div class="answer-review-text">
                        {{ choice }}
                      </div>
                      <div class="answer-review-icon">
                        @if ($index === question.correctAnswerIndex) {
                          <i class="bi bi-check-circle-fill text-success"></i>
                        }
                        @if ($index === getUserAnswerForQuestion(question)?.selectedAnswerIndex && $index !== question.correctAnswerIndex) {
                          <i class="bi bi-x-circle-fill text-danger"></i>
                        }
                      </div>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>

      <!-- Action Buttons -->
      <div class="actions-section mt-4">
        <div class="d-flex gap-3 justify-content-center flex-wrap">
          <button class="btn btn-primary btn-lg" (click)="goToApplications()">
            <i class="bi bi-briefcase me-2"></i>
            View My Applications
          </button>
          <button class="btn btn-outline-primary btn-lg" (click)="goToDashboard()">
            <i class="bi bi-house me-2"></i>
            Go to Dashboard
          </button>
        </div>
      </div>
    </div>
  }
</div>
