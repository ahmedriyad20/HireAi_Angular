<div class="profile-wrapper">
  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <p class="loading-text">Loading your profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-container">
    <div class="error-box">
      <i class="bi bi-exclamation-triangle"></i>
      <h2>Oops! Something went wrong</h2>
      <p>{{ error() }}</p>
      <button class="retry-btn" (click)="loadProfile()">
        <i class="bi bi-arrow-clockwise"></i>
        Try Again
      </button>
    </div>
  </div>

  <!-- Profile Content - All Data on One Page -->
  <div *ngIf="profile() && !loading()" class="profile-page">
    <!-- Hero Header Section -->
    <div class="profile-hero">
      <!-- Edit Button -->
      <button *ngIf="!isEditMode()" class="edit-profile-btn animate-fade-in" (click)="enterEditMode()">
        <i class="bi bi-pencil"></i>
        Edit Profile
      </button>

      <div class="hero-background"></div>
      <div class="hero-content">
        <div class="profile-avatar animate-scale-in">
          <div class="avatar-circle">
            {{ profile()!.name.charAt(0).toUpperCase() }}
          </div>
          <div class="status-indicator" [class.active]="profile()!.isActive">
            <span class="status-dot"></span>
            <span class="status-text">{{ profile()!.isActive ? 'Active' : 'Inactive' }}</span>
          </div>
        </div>
        
        <div class="hero-text animate-slide-up">
          <h1 class="profile-title-main">{{ profile()!.name }}</h1>
          <p class="profile-job-title">{{ profile()!.title }}</p>
          <div class="hero-meta">
            <div class="meta-badge">
              <i class="bi bi-envelope"></i>
              {{ profile()!.email }}
            </div>
            <div class="meta-badge">
              <i class="bi bi-telephone"></i>
              {{ profile()!.phone }}
            </div>
            <div class="meta-badge">
              <i class="bi bi-geo-alt"></i>
              {{ profile()!.address || 'No address provided' }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Form Modal -->
    <div *ngIf="isEditMode()" class="edit-modal">
      <div class="edit-modal-content">
        <div class="edit-modal-header">
          <h2><i class="bi bi-pencil-square"></i> Edit Profile</h2>
          <button class="close-btn" (click)="cancelEdit()" [disabled]="isSaving()">
            <i class="bi bi-x-lg"></i>
          </button>
        </div>

        <!-- Error Message in Modal -->
        <div *ngIf="error() && isEditMode()" class="modal-error">
          <i class="bi bi-exclamation-triangle"></i>
          {{ error() }}
        </div>

        <form (ngSubmit)="saveProfile()" class="edit-form">
          <!-- Personal Information Section -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="bi bi-person-circle"></i> Personal Information
            </h3>
            <div class="form-row">
              <div class="form-group">
                <label for="fullName">
                  <i class="bi bi-person"></i> Full Name
                </label>
                <input
                  type="text"
                  id="fullName"
                  [(ngModel)]="editForm.fullName"
                  name="fullName"
                  required
                  [disabled]="isSaving()"
                />
              </div>

              <div class="form-group">
                <label for="dateOfBirth">
                  <i class="bi bi-calendar"></i> Date of Birth
                </label>
                <input
                  type="date"
                  id="dateOfBirth"
                  [(ngModel)]="editForm.dateOfBirth"
                  name="dateOfBirth"
                  required
                  [disabled]="isSaving()"
                />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="phone">
                  <i class="bi bi-telephone"></i> Phone
                </label>
                <input
                  type="tel"
                  id="phone"
                  [(ngModel)]="editForm.phone"
                  name="phone"
                  required
                  [disabled]="isSaving()"
                />
              </div>

              <div class="form-group">
                <label for="address">
                  <i class="bi bi-geo-alt"></i> Address
                </label>
                <input
                  type="text"
                  id="address"
                  [(ngModel)]="editForm.address"
                  name="address"
                  [disabled]="isSaving()"
                />
              </div>
            </div>
          </div>

          <!-- Professional Information Section -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="bi bi-briefcase"></i> Professional Information
            </h3>
            <div class="form-row">
              <div class="form-group">
                <label for="title">
                  <i class="bi bi-badge"></i> Job Title
                </label>
                <input
                  type="text"
                  id="title"
                  [(ngModel)]="editForm.title"
                  name="title"
                  required
                  [disabled]="isSaving()"
                />
              </div>

              <div class="form-group">
                <label for="skillLevel">
                  <i class="bi bi-star"></i> Skill Level
                </label>
                <select
                  id="skillLevel"
                  [(ngModel)]="editForm.skillLevel"
                  name="skillLevel"
                  required
                  [disabled]="isSaving()"
                >
                  <option value="Beginner">Beginner</option>
                  <option value="Intermediate">Intermediate</option>
                  <option value="Advanced">Advanced</option>
                  <option value="Expert">Expert</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="bio">
                <i class="bi bi-card-text"></i> Bio / Summary
              </label>
              <textarea
                id="bio"
                [(ngModel)]="editForm.bio"
                name="bio"
                rows="4"
                placeholder="Tell us about yourself, your experience, and what you're looking for..."
                [disabled]="isSaving()"
              ></textarea>
            </div>
          </div>

          <!-- Resume Upload Section -->
          <div class="form-section">
            <h3 class="section-title">
              <i class="bi bi-file-earmark-pdf"></i> Resume
            </h3>
            <div class="form-group">
              <app-file-upload
                [title]="'Upload New Resume'"
                [description]="'Drag and drop your PDF resume or click to browse'"
                [accept]="'.pdf'"
                [maxSize]="10485760"
                (fileSelected)="handleResumeFileSelect($event)">
              </app-file-upload>
              <small class="text-muted">
                <i class="bi bi-info-circle"></i> Leave empty to keep your current resume. Maximum file size: 10MB
              </small>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn-cancel"
              (click)="cancelEdit()"
              [disabled]="isSaving()"
            >
              <i class="bi bi-x-circle"></i>
              Cancel
            </button>
            <button
              type="submit"
              class="btn-save"
              [disabled]="isSaving()"
            >
              <i class="bi" [ngClass]="isSaving() ? 'bi-hourglass-split' : 'bi-check-circle'"></i>
              {{ isSaving() ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div class="profile-content">
      <!-- Left Column: Personal Details -->
      <div class="column-left">
        <!-- About Section -->
        <section class="profile-section animate-fade-in-left">
          <div class="section-header">
            <i class="bi bi-person-circle"></i>
            <h2>About</h2>
          </div>
          <div class="section-content">
            <p class="bio-text">{{ profile()!.bio }}</p>
            <div class="about-grid">
              <div class="about-item">
                <span class="label">Skill Level</span>
                <span class="value skill-level-badge">
                  <i class="bi bi-star-fill"></i>
                  {{ profile()!.skillLevel }}
                </span>
              </div>
              <div class="about-item">
                <span class="label">Member Since</span>
                <span class="value">{{ formatDate(profile()!.createdAt) }}</span>
              </div>
              <div class="about-item">
                <span class="label">Address</span>
                <span class="value">{{ profile()!.address || 'Not specified' }}</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Personal Information Section -->
        <section class="profile-section animate-fade-in-left" style="animation-delay: 0.1s">
          <div class="section-header">
            <i class="bi bi-info-circle"></i>
            <h2>Personal Information</h2>
          </div>
          <div class="section-content">
            <div class="info-list">
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-at"></i>
                  ID
                </span>
                <span class="info-value">{{ profile()!.id }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-envelope-at"></i>
                  Email
                </span>
                <span class="info-value">{{ profile()!.email }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-telephone"></i>
                  Phone
                </span>
                <span class="info-value">{{ profile()!.phone }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-calendar-event"></i>
                  Date of Birth
                </span>
                <span class="info-value">{{ profile()!.dateOfBirth }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-briefcase"></i>
                  Title
                </span>
                <span class="info-value">{{ profile()!.title }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-geo-alt"></i>
                  Address
                </span>
                <span class="info-value">{{ profile()!.address || 'Not specified' }}</span>
              </div>
              <div class="info-item">
                <span class="info-label">
                  <i class="bi bi-check-circle"></i>
                  Status
                </span>
                <span class="info-value status-tag" [class.active]="profile()!.isActive">
                  {{ profile()!.isActive ? '✓ Active' : '✗ Inactive' }}
                </span>
              </div>
            </div>
          </div>
        </section>

        <!-- Account Activity Section -->
        <section class="profile-section animate-fade-in-left" style="animation-delay: 0.2s">
          <div class="section-header">
            <i class="bi bi-clock-history"></i>
            <h2>Account Activity</h2>
          </div>
          <div class="section-content">
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-marker">
                  <i class="bi bi-person-plus"></i>
                </div>
                <div class="timeline-content">
                  <h4>Account Created</h4>
                  <p>{{ formatDate(profile()!.createdAt) }}</p>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-marker">
                  <i class="bi bi-box-arrow-in-right"></i>
                </div>
                <div class="timeline-content">
                  <h4>Last Login</h4>
                  <p>{{ formatDate(profile()!.lastLogin) }}</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Resume Section -->
        <section class="profile-section animate-fade-in-left" style="animation-delay: 0.3s">
          <div class="section-header">
            <i class="bi bi-file-pdf"></i>
            <h2>Resume</h2>
          </div>
          <div class="section-content">
            <div class="resume-box">
              <i class="bi bi-file-earmark-pdf"></i>
              <p class="resume-url">{{ profile()!.resumeUrl }}</p>
              <a [href]="profile()!.resumeUrl" target="_blank" class="download-btn">
                <i class="bi bi-download"></i>
                Download Resume
              </a>
            </div>
          </div>
        </section>
      </div>

      <!-- Right Column: Skills -->
      <div class="column-right">
        <!-- Skills Section -->
        <section class="profile-section skills-section animate-fade-in-right">
          <div class="section-header">
            <i class="bi bi-lightning-charge"></i>
            <h2>Skills & Proficiency</h2>
            <span class="skill-count">{{ profile()!.applicantSkills.length }} Skills</span>
          </div>
          <div class="section-content">
            <div class="skills-list">
              <div
                *ngFor="let skill of profile()!.applicantSkills; let i = index"
                class="skill-item animate-slide-up"
                [style.animation-delay]="(i * 0.08) + 's'"
              >
                <div class="skill-header">
                  <h4 class="skill-name">{{ skill.skillName }}</h4>
                  <span class="skill-rate" [ngClass]="'rate-' + getSkillColor(skill.skillRate)">
                    {{ skill.skillRate }}%
                  </span>
                </div>
                
                <div class="skill-bar-wrapper">
                  <div class="skill-bar-bg">
                    <div
                      class="skill-bar-fill"
                      [ngClass]="'fill-' + getSkillColor(skill.skillRate)"
                      [style.width.%]="skill.skillRate"
                      [style.animation-delay]="(i * 0.1) + 's'"
                    ></div>
                  </div>
                </div>

                <div class="skill-meta">
                  <span class="skill-level">
                    <i class="bi bi-star-fill"></i>
                    <span *ngIf="skill.skillRate >= 80">Expert</span>
                    <span *ngIf="skill.skillRate >= 60 && skill.skillRate < 80">Advanced</span>
                    <span *ngIf="skill.skillRate >= 40 && skill.skillRate < 60">Intermediate</span>
                    <span *ngIf="skill.skillRate < 40">Beginner</span>
                  </span>
                  <span class="skill-id">ID: {{ skill.skillId }}</span>
                </div>

                <div class="skill-details" *ngIf="skill.improvementPercentage !== null || skill.notes">
                  <div *ngIf="skill.improvementPercentage !== null" class="detail-item">
                    <span class="label">Improvement:</span>
                    <span class="value">{{ skill.improvementPercentage }}%</span>
                  </div>
                  <div *ngIf="skill.notes" class="detail-item">
                    <span class="label">Notes:</span>
                    <span class="value">{{ skill.notes }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Skills Summary Stats -->
        <section class="profile-section skills-stats animate-fade-in-right" style="animation-delay: 0.1s">
          <div class="section-header">
            <i class="bi bi-graph-up"></i>
            <h2>Overall Stats</h2>
          </div>
          <div class="section-content">
            <div class="stats-grid">
              <div class="stat-box">
                <div class="stat-value">{{ profile()!.applicantSkills.length }}</div>
                <div class="stat-label">Total Skills</div>
              </div>
              <div class="stat-box">
                <div class="stat-value">{{ getAverageProficiency() }}%</div>
                <div class="stat-label">Average Proficiency</div>
              </div>
              <div class="stat-box">
                <div class="stat-value">{{ getExpertSkillsCount() }}</div>
                <div class="stat-label">Expert Skills</div>
              </div>
              <div class="stat-box">
                <div class="stat-value">{{ getAdvancedSkillsCount() }}</div>
                <div class="stat-label">Advanced Skills</div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
</div>
